<form  id="formu" action="<?php echo $this->element->getAction(); ?>"       method="<?php echo $this->element->getMethod(); ?>"      enctype="<?php echo $this->element->getAttrib('enctype'); ?>">    <div class="header_venta">      <div class="headerCliente">          <label class="frm_label5">Cliente</label>           <?php echo $this->element->searchCliente ?>        &nbsp;        <a id="actionViewModal" style="cursor: pointer">            <img src="../../f/img/Usuarios.gif" />        </a>         <label id="ldni"></label>     </div>    <input type="hidden" value="" id="idcliente" name="idcliente">     <div class="suggestionsBox" id="suggestions" style="display: none;">        <div class="suggestionList" id="autoSuggestionsList"> </div>     </div>        <div class="headerArticulo">         <label class="frm_label5"> Articulo</label>        <?php echo $this->element->searchArticulo ?>                        </div>    <div class="suggestionsBox" id="suggestions2" style="display: none;">            <div class="suggestionList" id="autoSuggestionsList2"> </div>        </div>      </div>            <table id="tableArticulo" class="sticky-enabled tableSelect-processed sticky-table">        <thead class="tableHeader-processed">            <tr>                <th>Nombre</th>                <th>Descripci√≥n</th>                <th>Precio</th>                <th>Cantidad</th>                <th>Total</th>            </tr>        </thead>        <tbody>        </tbody>        <tr>            <td> </td>            <td> </td>            <td> </td>            <td style="color: red; font-weight: bold"> Total General </td>            <td style="color: red; font-weight: bold"> <span id="total">0</span></td>            <td> </td>        </tr>    </table>    <div class="pie_venta">         <div style="float :left; width: 350px">            <label class="frm_label5">Direccion</label>             <?php echo $this->element->direccion ?>            </br> </br>            <div>            <label class='frm_label5'>Tip. Doc</label>            <?php echo $this->element->tipoDocumento ?>            <span id="spanNumSerie">                <?php echo $this->element->numSerie ?>            </span>            <?php echo $this->element->numComprobante ?>            </div>        </div>        <div style =" margin-left: 352px;" >            <label class="frm_label4">Fec. Entrega</label>            <?php echo $this->element->fechaEntrega ?>                            <label class="frm_label5">Hora</label>            <?php echo $this->element->hora ?>            <?php echo $this->element->minuto ?>        </div>        <div style="clear:left"></div>        <div>                        <div>                <?php echo $this->element->informacionAdicional ?>            </div>        </div>        <div>            <?php echo $this->element->searchTextResponsable ?>            <span id="responsableSearch" style="position: absolute; background-color: #009ede;">            </span>            <span id="responsable"></span>        </div>    </div>     <div>         <?php echo $this->element->enviar ?>        <?php echo $this->element->cancelar ?>    </div></form><div id="dialog-form" title="Ingresar Nuevo Usuario">    <p class="validateTips">* Todos estos campos son requeridos.</p>    <?php echo $this->element->getView()->formularioCliente; ?></div><script type="text/javascript">    $(function() {        $('#numSerie').live('change',function(){            $.ajax({                data: "idTipoComprobante="+this.value,                type: "POST",                dataType: "json",                url: "/admin/pedidos/ajax-generar-num-comprobante",                success: function(data){ }            });        })        $('#tipoDocumento').change(function(){            $.ajax({                data: "idTipoComprobante="+this.value,                type: "POST",                dataType: "json",                url: "/admin/pedidos/ajax-listar-numero-serie",                success: function(data){                     var contenido ='<select id="numSerie" name="numSerie">';                    contenido = contenido + '<option value="">---</option>';                    for (var i = 0; i < data.length; i++) {                         contenido = contenido + '<option value="'+ data[i]['serie'] +'">'+ data[i]['serie'] +'</option>';                    }                    contenido = contenido + '</select>';                    $('#numSerie-element').empty();                    $('#numSerie-element').append(contenido);                }            });        });        // $('#actionViewModal').click(function(){        //    $("#modalView").attr('class','modalActive');         //});        $("#searchTextResponsable").keypress(function(e) {            if(e.which == 13){                e.preventDefault();                searchResponsable(this.value);            }         });            $( "#searchCliente" ).keypress(function(e) {            if(e.which == 13){                e.preventDefault();                var valor = this.value;                       $.ajax({                    data: "searchCliente="+valor,                    type: "POST",                    dataType: "json",                    url: "/admin/pedidos/ajax-search-clientes",                    success: function(data){                      $('#autoSuggestionsList').empty();                         var contenido='';                        contenido = '<ul>';                        for (var i = 0; i < data.length; i++) {                             contenidoHidden  = '';                            contenidoHidden  = contenidoHidden +data[i]['nombre'];                            contenidoHidden  = contenidoHidden +'&nbsp;&nbsp;'+data[i]['apellidomaterno']+ ' ' +data[i]['apellidopaterno'];                            contenidoHidden2 = '';                            if(data[i]['ruc']!=''){                                                            contenidoHidden2 = 'RUC: '+data[i]['ruc']+', ';                            }                            if(data[i]['movil']){                                contenidoHidden2 = ' Movil: '+data[i]['movil']+', ';                            }                            if(data[i]['dni']){                                contenidoHidden2 = ' DNI:  '+data[i]['dni'];                            }                            contenido = contenido + '<li style="cursor:pointer" name="asa" id="itemCliente-'+data[i]['idcliente']+'">';                            contenido = contenido + '&nbsp;&nbsp;&nbsp;';                            contenido = contenido + "<input type='hidden' id='itemHiddenCliente-"+data[i]['idcliente']+"'   value='"+contenidoHidden+"' >";                            contenido = contenido + "<input type='hidden' id='itemHiddenCliente2-"+data[i]['idcliente']+"'   value='"+contenidoHidden2+"' >";                            contenido = contenido + data[i]['nombre'];                            contenido = contenido + data[i]['apellidomaterno'] +' '+ data[i]['apellidopaterno'];                            contenido = contenido + '</li>';                                                    }                        contenido = contenido +'</ul>';                                                $('#autoSuggestionsList').append(contenido);                        $('#suggestions').show();                                            }                });            }        })	        $( "#searchArticulo" ).keypress(function(e) {            if(e.which == 13){                e.preventDefault();                var valor = this.value;                       $.ajax({                    data: "searchArticulo="+valor,                    type: "POST",                    dataType: "json",                    url: "/admin/pedidos/ajax-search-articulos",                    success: function(data){                        $('#autoSuggestionsList2').empty();                         var contenido='';                        var contenidoHidden='';                        contenido = '<ul>';                        for (var i = 0; i < data.length; i++) {                             contenidoHidden = contenidoHidden +'<tr id="row_'+data[i]['idarticulo']+'">';                            contenidoHidden = contenidoHidden +'<td>'+data[i]['nomArticulo']+'<input type="hidden" name="idarticulo[]" value="'+data[i]['idarticulo']+'" id="idarticulo_'+data[i]['idarticulo']+'"></td>';                            contenidoHidden = contenidoHidden +'<td>'+data[i]['descArticulo']+'</td>';                            contenidoHidden = contenidoHidden +'<td><input name="precio[]" id="precio_'+data[i]['idarticulo']+'" type="text" value="'+parseFloat(data[i]['precioventa'])+'"></td>';                            contenidoHidden = contenidoHidden +'<td><input name="cantidad[]" id="cantidad_'+data[i]['idarticulo']+'" type="text" value="1"></td>';                            contenidoHidden = contenidoHidden +'<td><input name="total[]" id="total_'+data[i]['idarticulo']+'"  disabled="disabled" type="text" value="0"></td>';                            contenidoHidden = contenidoHidden +'<td>[<a id="eliminarArti-'+data[i]['idarticulo']+'" href="#">Eliminar</a>]</td>';                            contenidoHidden = contenidoHidden +'</tr>';                            contenido = contenido + '<li style="cursor:pointer" id="itemArticulo-'+data[i]['idarticulo']+'">';                            contenido = contenido + "<input type='hidden' value='"+contenidoHidden+"' id='itemArticuloHide-"+data[i]['idarticulo']+"'>";                            contenido = contenido + data[i]['nomArticulo'];                            contenido = contenido + '</li>';                                                        contenidoHidden='';                        }                                                    contenido = contenido + '</ul>';                        $('#autoSuggestionsList2').append(contenido);                        $('#suggestions2').show();                     }                });            }        })        $("[id^=itemCliente]").live("click",function(){            var idClienteArray = this.id.split('-');            contenValueHiden = $("#itemHiddenCliente-"+idClienteArray[1]).attr('value');            contenValueHiden2 = $("#itemHiddenCliente2-"+idClienteArray[1]).attr('value');            mostrarCLiente(contenValueHiden,contenValueHiden2,idClienteArray[1]);            $('#autoSuggestionsList').empty();        });        $("[id^=itemResponsable]").live("click",function(){            var idClienteArray = this.id.split('-');            mostrarResponsable(idClienteArray[1]);        });            $("[id^=itemArticulo]").live("click",function(){            var idClienteArray = this.id.split('-');            contenValueHiden = $("#itemArticuloHide-"+idClienteArray[1]).attr('value');            mostrarArticulo(contenValueHiden,idClienteArray[1]);              $('#autoSuggestionsList2').empty();        });            $("[id^=eliminarArti]").live("click",function(){            var idArticuloArray = this.id.split('-');            $(this).parent().parent().remove();            eliminaArticulo(idArticuloArray[1]);            totalProductos();        });        function mostrarResponsable(idusuario){            $.ajax({                data: "idusuario="+idusuario,                type: "POST",                dataType: "json",                url: "/admin/pedidos/ajax-get-responsable",                success: function(data){                    var contenido='';                    var nombre = data['apellidomaterno'];                    nombre = nombre + ' ' + data['apellidopaterno'];                    nombre = nombre + ' ' + data['nombre'];                    contenido = nombre+'<input type="hidden" id="idusuario" value='+idusuario+'>';                    $('#responsable').empty();                     $('#responsableSearch').empty();                     $('#responsable').append(contenido);                            }            });        }        function eliminaArticulo(idArticulo){            $.ajax({                data: "idArticulo="+idArticulo,                type: "POST",                dataType: "json",                url: "/admin/pedidos/ajax-delete-articulo",                success: function(data){}            });        }        function mostrarArticulo(contenido,idArticulo){            $('#autocompleteArticulo').empty();             $('#tableArticulo tr:first').after(contenido);            totalItem(idArticulo);                $.ajax({                data: "idArticulo="+idArticulo,                type: "POST",                dataType: "json",                url: "/admin/pedidos/ajax-get-articulo",                success: function(data){}            });             setTimeout("$('#suggestions2').hide();", 200);        }        $("[id^=precio_]").live("keyup",function(e){            var splitId = this.id.split('_');            totalItem(splitId[1]);        });        $("[id^=cantidad_]").live("keyup",function(e){            var splitId = this.id.split('_');            totalItem(splitId[1]);        });        function totalProductos(){            var total =0;            $("[id^=idarticulo_]").each(function(){                var splitId = this.id.split('_');                total = total + parseFloat($('#total_'+splitId[1]).attr('value'));            });            $('#total').empty();             $('#total').append(total);        }        function totalItem(idArticulo){            $('#total_'+idArticulo).attr('value',parseFloat($('#precio_'+idArticulo).attr('value'))*parseFloat($('#cantidad_'+idArticulo).attr('value')));            totalProductos();        }        function searchResponsable(textSearch){            $.ajax({                data: "buscarResponsable="+textSearch,                type: "POST",                dataType: "json",                url: "/admin/pedidos/ajax-search-responsable",                success: function(data){                    var contenido='';                    contenido = '<div><table>';                    for (var i = 0; i < data.length; i++) {                         var nombre = data[i]['apellidomaterno'];                        nombre = nombre + ' ' + data[i]['apellidopaterno'];                        nombre = nombre + ' ' + data[i]['nombre'];                        contenido = contenido + '<tr style="cursor:pointer" name="asa" id="itemResponsable-'+data[i]['idusuario']+'">';                        contenido = contenido + '<td>';                        contenido = contenido + nombre;                        contenido = contenido + '</td>';                        contenido = contenido + '</tr>';                    }                    contenido = contenido + '</table></div>';                    $('#responsableSearch').empty();                     $('#responsableSearch').append(contenido);                }            });        }        function mostrarCLiente(contenido,contenido2,idcliente){            $('#ldni').empty();            $('#idcliente').attr('value',idcliente);             $('#searchCliente').attr('value',contenido);            $('#ldni').append(contenido2);            setTimeout("$('#suggestions').hide();", 200);        }    });    $(function() {        $( "#dialog:ui-dialog" ).dialog( "destroy" );        var nombre          = $( "#nombre" );        apellidopaterno = $( "#apellidopaterno" );        apellidomaterno = $( "#apellidomaterno" );        correo          = $( "#correo" );        //direccion       = $( "#direccion" ),        allFields = $( [] ).add(nombre).add( apellidopaterno ).add( apellidomaterno).add( correo );//.add( direccion ),        tips = $( ".validateTips" );        function updateTips( t ) {            tips            .text( t )            .addClass( "ui-state-highlight" );            setTimeout(function() {                tips.removeClass( "ui-state-highlight", 1500 );            }, 500 );        }        function checkLength( o, n, min, max ) {            if ( o.val().length > max || o.val().length < min ) {                o.addClass( "ui-state-error" );                updateTips( "Las letras del " + n + " deben estar entre " +                    min + " y " + max + "." );                return false;            } else {                return true;            }        }        function checkRegexp( o, regexp, n ) {            if ( !( regexp.test( o.val() ) ) ) {                o.addClass( "ui-state-error" );                updateTips( n );                return false;            } else {                return true;            }        }		        $( "#dialog-form" ).dialog({            autoOpen: false,            height: 500,            width: 550,            modal: true,            buttons: {                "Crear Usuario": function() {                    var bValid = true;                    allFields.removeClass( "ui-state-error" );                    bValid = bValid && checkLength( nombre, "nombre", 3, 20 );                    bValid = bValid && checkLength( apellidopaterno, "apellidopaterno", 3, 20 );                    bValid = bValid && checkLength( apellidomaterno, "apellidomaterno", 3, 16 );                    //bValid = bValid && checkLength( direccion, "direccion", 3, 16 );                    bValid = bValid && checkLength( correo, "correo", 6, 80 );                                                    bValid = bValid && checkRegexp(nombre, /^[a-z]([0-9a-z_])+$/i, "nombre debe tener  a-z, 0-9, subraya, comenzar con una letra." );                    bValid = bValid && checkRegexp(apellidopaterno, /^[a-z]([0-9a-z_])+$/i, "Apellido Paterno debe tener  a-z, 0-9, subraya, comenzar con una letra." );                    bValid = bValid && checkRegexp(apellidomaterno, /^[a-z]([0-9a-z_])+$/i, "Apellido Materno tener  a-z, 0-9, subraya, comenzar con una letra." );                    //bValid = bValid && checkRegexp(direccion, /^[a-z]([0-9a-z_])+$/i, "direccion debe tener  a-z, 0-9, subraya, comenzar con una letra." );                    // From jquery.validate.js (by joern), contributed by Scott Gonzalez: http://projects.scottsplayground.com/email_address_validation/                    bValid = bValid && checkRegexp( correo, /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i, "eg. ui@jquery.com" );                    if ( bValid ) {                                                                    fn_agregar();                        $(this).dialog( "close" );                    }                                                    },                Cancel: function() {                    $( this ).dialog( "close" );                }            },            close: function() {                allFields.val( "" ).removeClass( "ui-state-error" );            }        });        $( "#actionViewModal" )        .button()        .click(function() {            $( "#dialog-form" ).dialog( "open" );        });    });    function fn_agregar(){        var str = $("#form_cliente").serialize();        $.ajax({            url: 'pedidos/nuevo-cliente-ajax',            data: str,            type: 'post',            success: function(data){                if(data != ""){                    var datos = data['data2']['nombre']+' '+data['data2']['apellidopaterno']+' '+data['data2']['apellidomaterno'];                    $('#searchCliente').attr('value',datos);                                        var datos2 = '';                    if(data['data2']['ruc']!=''){                        datos2 = datos2+' RUC: '+ data['data2']['dni']+', ';                                            }                    if(data['data2']['dni']!=''){                        datos2 = datos2+' DNI: '+ data['data2']['dni']+', ';                                            }                    if(data['data2']['movil']!=''){                        datos2 = datos2+' Celular: '+ data['data2']['movil'];                                            }                    $("#ldni").append(datos2);                    $('#idcliente').attr('value',data['data2']['idcliente']);                  }            }        });    };        </script>